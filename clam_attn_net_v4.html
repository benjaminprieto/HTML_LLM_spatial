<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CLAM â€” Attention Net</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@300;400;500;600;700&family=IBM+Plex+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#f8f9fb; --surface:#fff; --surface2:#f0f2f5;
  --border:#d0d5dd; --border-light:#e4e7ec;
  --text:#1a1d23; --dim:#6b7280; --dimmer:#9ca3af;
  --blue:#2563eb; --blue-bg:rgba(37,99,235,0.07);
  --purple:#7c3aed; --purple-bg:rgba(124,58,237,0.07);
  --teal:#0891b2; --teal-bg:rgba(8,145,178,0.07);
  --orange:#d97706; --orange-bg:rgba(217,119,6,0.07);
  --green:#059669; --green-bg:rgba(5,150,105,0.07);
  --red:#dc2626; --red-bg:rgba(220,38,38,0.06);
  --rose:#e11d48; --rose-bg:rgba(225,29,72,0.06);
  --slate:#475569;
}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--bg);color:var(--text);font-family:'IBM Plex Sans',sans-serif;line-height:1.5;padding:40px 24px 80px;}
.page{max-width:1200px;margin:0 auto;}
.hdr{text-align:center;margin-bottom:48px;padding-bottom:28px;border-bottom:2px solid var(--border-light);}
.tag{display:inline-block;font-size:.6rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--teal);background:var(--teal-bg);border:1.5px solid rgba(8,145,178,.25);padding:5px 16px;border-radius:20px;margin-bottom:14px;}
.hdr h1{font-size:2rem;font-weight:700;letter-spacing:-.7px;margin-bottom:8px;}
.hdr .sub{color:var(--dim);font-size:.92rem;max-width:680px;margin:0 auto;}
.specs{display:flex;justify-content:center;gap:28px;margin-top:18px;flex-wrap:wrap;}
.specs span{font-family:'IBM Plex Mono',monospace;font-size:.72rem;color:var(--dim);background:var(--surface);border:1px solid var(--border-light);padding:4px 12px;border-radius:8px;}
.specs span b{color:var(--text);}
.section-label{display:flex;align-items:center;gap:12px;margin:44px 0 20px;padding-left:4px;}
.section-label .num{width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-family:'IBM Plex Mono',monospace;font-size:.8rem;font-weight:700;color:#fff;flex-shrink:0;}
.section-label h2{font-size:1.05rem;font-weight:600;letter-spacing:-.2px;}
.section-label .slide-ref{margin-left:auto;font-family:'IBM Plex Mono',monospace;font-size:.65rem;color:var(--dim);background:var(--surface2);padding:3px 10px;border-radius:6px;border:1px solid var(--border-light);}
.card{background:var(--surface);border:1.5px solid var(--border-light);border-radius:14px;overflow:hidden;}
.card-body{padding:28px;}
.diagram-wrap{width:100%;overflow-x:auto;padding:8px 0;}
.diagram-wrap svg{display:block;margin:0 auto;}
svg text{font-family:'IBM Plex Sans',sans-serif;}
svg .mono{font-family:'IBM Plex Mono',monospace;}
.insight{display:flex;gap:12px;border-radius:10px;padding:14px 18px;margin-top:18px;font-size:.82rem;line-height:1.55;align-items:flex-start;}
.insight .icon{font-size:1.1rem;flex-shrink:0;margin-top:1px;}
.insight b{font-weight:700;}
.insight-teal{background:var(--teal-bg);border:1px solid rgba(8,145,178,.2);color:#155e75;}
.insight-rose{background:var(--rose-bg);border:1px solid rgba(225,29,72,.2);color:#9f1239;}
.insight-orange{background:var(--orange-bg);border:1px solid rgba(217,119,6,.2);color:#92400e;}
.insight-blue{background:var(--blue-bg);border:1px solid rgba(37,99,235,.2);color:#1e40af;}
.stats{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:16px;}
.stat{background:var(--surface2);border-radius:8px;padding:10px 14px;border:1px solid var(--border-light);text-align:center;}
.stat .k{font-size:.58rem;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--dim);}
.stat .v{font-family:'IBM Plex Mono',monospace;font-size:.85rem;font-weight:700;margin-top:3px;}
</style>
</head>
<body>
<div class="page">

<!-- HEADER -->
<div class="hdr">
  <div class="tag">HTML 1 Â· CLAM_MB</div>
  <h1>Attention Net</h1>
  <p class="sub">FC Compression + Gated Attention â€” cÃ³mo CLAM decide quÃ© patches importan para cada clase</p>
  <div class="specs">
    <span><b>Input</b> (K, 1024)</span>
    <span><b>FC</b> 1024â†’512</span>
    <span><b>Gated</b> tanh âŠ™ Ïƒ</span>
    <span><b>Output</b> A(K,4) + H(K,512)</span>
    <span><b>Slides</b> 2-3</span>
  </div>
</div>

<!-- ======== SECTION 1: Overview ======== -->
<div class="section-label">
  <div class="num" style="background:var(--teal);">1</div>
  <h2>Vista General â€” Attention Net completa</h2>
  <span class="slide-ref">Slide 2</span>
</div>
<div class="card"><div class="card-body">
  <div class="diagram-wrap">
    <svg width="1050" height="360" viewBox="0 0 1050 360">
      <defs>
        <marker id="arr" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="9" markerHeight="7" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="var(--slate)"/></marker>
        <marker id="arr-teal" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="9" markerHeight="7" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="var(--teal)"/></marker>
        <marker id="arr-rose" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="9" markerHeight="7" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="var(--rose)"/></marker>
        <marker id="arr-red" viewBox="0 0 10 7" refX="9" refY="3.5" markerWidth="9" markerHeight="7" orient="auto"><polygon points="0 0,10 3.5,0 7" fill="var(--red)"/></marker>
      </defs>

      <!-- Dim labels -->
      <text x="70" y="18" text-anchor="middle" class="mono" font-size="11" font-weight="600" fill="var(--dim)">h(K, 1024)</text>
      <line x1="70" y1="24" x2="70" y2="50" stroke="var(--border)" stroke-width="1" stroke-dasharray="3,3"/>

      <!-- EMBEDDINGS -->
      <rect x="10" y="58" width="120" height="165" rx="12" fill="var(--surface2)" stroke="var(--border)" stroke-width="1.5"/>
      <text x="70" y="84" text-anchor="middle" font-size="11" font-weight="600" fill="var(--dim)">Embeddings</text>
      <rect x="22" y="98" width="96" height="16" rx="3" fill="rgba(71,85,105,.06)"/>
      <text x="70" y="110" text-anchor="middle" class="mono" font-size="7.5" fill="var(--dim)">[0.12, 0.75, ... 0.14]</text>
      <rect x="22" y="118" width="96" height="16" rx="3" fill="rgba(71,85,105,.06)"/>
      <text x="70" y="130" text-anchor="middle" class="mono" font-size="7.5" fill="var(--dim)">[0.85, 0.21, ... 0.14]</text>
      <rect x="22" y="138" width="96" height="16" rx="3" fill="rgba(71,85,105,.06)"/>
      <text x="70" y="150" text-anchor="middle" class="mono" font-size="7.5" fill="var(--dim)">[-0.05, 0.68, ... 0.41]</text>
      <text x="70" y="174" text-anchor="middle" font-size="14" fill="var(--dimmer)">â‹®</text>
      <rect x="22" y="182" width="96" height="16" rx="3" fill="rgba(71,85,105,.06)"/>
      <text x="70" y="194" text-anchor="middle" class="mono" font-size="7.5" fill="var(--dim)">[0.12, 0.75, ... 0.14]</text>
      <text x="70" y="218" text-anchor="middle" font-size="11" font-weight="700" fill="var(--slate)">K vectores</text>

      <!-- Arrow -->
      <line x1="135" y1="140" x2="168" y2="140" stroke="var(--slate)" stroke-width="2" marker-end="url(#arr)"/>

      <!-- LINEAR -->
      <rect x="176" y="98" width="110" height="84" rx="12" fill="var(--teal-bg)" stroke="var(--teal)" stroke-width="2.5"/>
      <text x="231" y="130" text-anchor="middle" font-size="14" font-weight="700" fill="var(--teal)">Linear</text>
      <text x="231" y="152" text-anchor="middle" class="mono" font-size="11" fill="var(--dim)">1024 â†’ 512</text>
      <text x="231" y="174" text-anchor="middle" font-size="9" fill="var(--dim)">Dim. reduction</text>

      <!-- h(K,512) label -->
      <text x="231" y="60" text-anchor="middle" class="mono" font-size="11" font-weight="600" fill="var(--teal)">h(K, 512)</text>
      <line x1="231" y1="66" x2="231" y2="94" stroke="var(--teal)" stroke-width="1" stroke-dasharray="3,3"/>

      <!-- Arrow -->
      <line x1="291" y1="140" x2="318" y2="140" stroke="var(--slate)" stroke-width="2" marker-end="url(#arr)"/>

      <!-- RELU -->
      <rect x="326" y="108" width="80" height="64" rx="10" fill="var(--green-bg)" stroke="var(--green)" stroke-width="2"/>
      <text x="366" y="138" text-anchor="middle" font-size="14" font-weight="700" fill="var(--green)">ReLU</text>
      <text x="366" y="160" text-anchor="middle" font-size="9" fill="var(--dim)">Activation</text>

      <!-- Arrow -->
      <line x1="411" y1="140" x2="438" y2="140" stroke="var(--slate)" stroke-width="2" marker-end="url(#arr)"/>

      <!-- DROPOUT -->
      <rect x="446" y="108" width="90" height="64" rx="10" fill="var(--orange-bg)" stroke="var(--orange)" stroke-width="2"/>
      <text x="491" y="136" text-anchor="middle" font-size="13" font-weight="700" fill="var(--orange)">Dropout</text>
      <text x="491" y="160" text-anchor="middle" class="mono" font-size="11" fill="var(--orange)">p = 0.25</text>

      <!-- Fork -->
      <line x1="541" y1="140" x2="576" y2="140" stroke="var(--slate)" stroke-width="2"/>
      <circle cx="582" cy="140" r="5" fill="var(--slate)"/>

      <!-- Branch A -->
      <line x1="582" y1="135" x2="582" y2="78" stroke="var(--purple)" stroke-width="2"/>
      <line x1="582" y1="78" x2="622" y2="78" stroke="var(--purple)" stroke-width="2" marker-end="url(#arr)"/>
      <rect x="630" y="48" width="125" height="60" rx="10" fill="var(--purple-bg)" stroke="var(--purple)" stroke-width="2.5"/>
      <text x="692" y="75" text-anchor="middle" font-size="13" font-weight="700" fill="var(--purple)">Attention A</text>
      <text x="692" y="97" text-anchor="middle" font-size="10" fill="var(--dim)">tanh path</text>

      <!-- Branch B -->
      <line x1="582" y1="145" x2="582" y2="208" stroke="var(--green)" stroke-width="2"/>
      <line x1="582" y1="208" x2="622" y2="208" stroke="var(--green)" stroke-width="2" marker-end="url(#arr)"/>
      <rect x="630" y="178" width="125" height="60" rx="10" fill="var(--green-bg)" stroke="var(--green)" stroke-width="2.5"/>
      <text x="692" y="205" text-anchor="middle" font-size="13" font-weight="700" fill="var(--green)">Attention B</text>
      <text x="692" y="227" text-anchor="middle" font-size="10" fill="var(--dim)">sigmoid path</text>

      <!-- Lines to âŠ— -->
      <line x1="759" y1="78" x2="792" y2="118" stroke="var(--purple)" stroke-width="2"/>
      <line x1="759" y1="208" x2="792" y2="168" stroke="var(--green)" stroke-width="2"/>

      <!-- âŠ— -->
      <circle cx="816" cy="140" r="28" fill="var(--surface)" stroke="var(--rose)" stroke-width="3.5"/>
      <text x="816" y="147" text-anchor="middle" font-size="22" font-weight="700" fill="var(--rose)">âŠ—</text>

      <!-- Arrow to C -->
      <line x1="848" y1="140" x2="882" y2="140" stroke="var(--rose)" stroke-width="2.5" marker-end="url(#arr-rose)"/>

      <!-- ATTENTION C -->
      <rect x="890" y="102" width="115" height="76" rx="12" fill="var(--red-bg)" stroke="var(--red)" stroke-width="2.5"/>
      <text x="947" y="132" text-anchor="middle" font-size="14" font-weight="700" fill="var(--red)">Attention C</text>
      <text x="947" y="152" text-anchor="middle" class="mono" font-size="10" fill="var(--dim)">256 â†’ n_cls</text>
      <text x="947" y="170" text-anchor="middle" font-size="9" fill="var(--dim)">class scores</text>

      <!-- Output labels -->
      <text x="947" y="210" text-anchor="middle" class="mono" font-size="11" font-weight="600" fill="var(--red)">A(K, 4)</text>
      <line x1="947" y1="182" x2="947" y2="200" stroke="var(--red)" stroke-width="1" stroke-dasharray="3,3"/>

      <!-- H passthrough -->
      <line x1="231" y1="186" x2="231" y2="300" stroke="var(--teal)" stroke-width="1.5" stroke-dasharray="5,3"/>
      <line x1="231" y1="300" x2="947" y2="300" stroke="var(--teal)" stroke-width="1.5" stroke-dasharray="5,3" marker-end="url(#arr-teal)"/>
      <rect x="500" y="288" width="230" height="24" rx="6" fill="var(--surface)" stroke="var(--teal)" stroke-width="1"/>
      <text x="615" y="305" text-anchor="middle" class="mono" font-size="10" font-weight="600" fill="var(--teal)">h(K, 512) passthrough â†’ HTML 2</text>

      <!-- Code label -->
      <text x="525" y="348" text-anchor="middle" font-size="10" class="mono" fill="var(--dim)">self.attention_net = nn.Sequential( Linear, ReLU, Dropout, Attn_Net_Gated )</text>
    </svg>
  </div>
  <div class="insight insight-teal">
    <span class="icon">ğŸ’¡</span>
    <span><b>Dual output:</b> La Attention Net retorna dos tensores â€” <b>A(K, 4)</b> con scores de atenciÃ³n por clase, y <b>h(K, 512)</b> pasado sin modificar. Ambos se usan en Attention Pooling (HTML 2).</span>
  </div>
</div></div>

<!-- ======== SECTION 2: Detail A, B, C ======== -->
<div class="section-label">
  <div class="num" style="background:var(--purple);">2</div>
  <h2>Detalle â€” Attention A, B y C</h2>
  <span class="slide-ref">Slide 3</span>
</div>
<div class="card"><div class="card-body">

  <!-- ATTENTION A -->
  <div class="diagram-wrap">
    <svg width="560" height="220" viewBox="0 0 560 220">
      <rect x="5" y="5" width="550" height="210" rx="14" fill="rgba(124,58,237,.04)" stroke="var(--purple)" stroke-width="1.8"/>
      <text x="25" y="32" font-size="14" font-weight="700" fill="var(--purple)">Attention A</text>
      <text x="145" y="32" class="mono" font-size="11" fill="var(--dim)">a(K, 256)</text>

      <!-- Input neurons -->
      <text x="35" y="60" font-size="10" font-weight="600" fill="var(--dim)">512-dim</text>
      <circle cx="50" cy="80" r="7" fill="var(--purple)" fill-opacity=".25" stroke="var(--purple)" stroke-width="1"/>
      <circle cx="50" cy="100" r="7" fill="var(--purple)" fill-opacity=".25" stroke="var(--purple)" stroke-width="1"/>
      <circle cx="50" cy="120" r="7" fill="var(--purple)" fill-opacity=".25" stroke="var(--purple)" stroke-width="1"/>
      <text x="50" y="145" text-anchor="middle" font-size="14" fill="var(--dimmer)">â‹®</text>
      <circle cx="50" cy="160" r="7" fill="var(--purple)" fill-opacity=".25" stroke="var(--purple)" stroke-width="1"/>

      <!-- Output neurons -->
      <text x="125" y="60" font-size="10" font-weight="600" fill="var(--dim)">256-dim</text>
      <circle cx="140" cy="86" r="7" fill="var(--purple)" fill-opacity=".5" stroke="var(--purple)" stroke-width="1.2"/>
      <circle cx="140" cy="112" r="7" fill="var(--purple)" fill-opacity=".5" stroke="var(--purple)" stroke-width="1.2"/>
      <circle cx="140" cy="138" r="7" fill="var(--purple)" fill-opacity=".5" stroke="var(--purple)" stroke-width="1.2"/>
      <text x="140" y="163" text-anchor="middle" font-size="14" fill="var(--dimmer)">â‹®</text>

      <!-- Connections -->
      <line x1="59" y1="80" x2="131" y2="86" stroke="var(--purple)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="59" y1="80" x2="131" y2="112" stroke="var(--purple)" stroke-width=".5" stroke-opacity=".1"/>
      <line x1="59" y1="100" x2="131" y2="86" stroke="var(--purple)" stroke-width=".5" stroke-opacity=".1"/>
      <line x1="59" y1="100" x2="131" y2="138" stroke="var(--purple)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="59" y1="120" x2="131" y2="112" stroke="var(--purple)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="59" y1="160" x2="131" y2="138" stroke="var(--purple)" stroke-width=".5" stroke-opacity=".2"/>

      <text x="95" y="192" text-anchor="middle" font-size="9" fill="var(--purple)">V_a Â· Linear</text>

      <!-- Arrow to Tanh -->
      <line x1="168" y1="112" x2="202" y2="112" stroke="var(--slate)" stroke-width="1.5" marker-end="url(#arr)"/>

      <!-- Tanh -->
      <rect x="210" y="82" width="100" height="60" rx="10" fill="var(--purple-bg)" stroke="var(--purple)" stroke-width="2.5"/>
      <text x="260" y="110" text-anchor="middle" font-size="15" font-weight="700" fill="var(--purple)">Tanh()</text>
      <text x="260" y="132" text-anchor="middle" font-size="9" fill="var(--dim)">Activation</text>

      <!-- Arrow to Dropout -->
      <line x1="315" y1="112" x2="349" y2="112" stroke="var(--slate)" stroke-width="1.5" marker-end="url(#arr)"/>

      <!-- Dropout -->
      <rect x="357" y="82" width="100" height="60" rx="10" fill="var(--orange-bg)" stroke="var(--orange)" stroke-width="2"/>
      <text x="407" y="108" text-anchor="middle" font-size="13" font-weight="700" fill="var(--orange)">Dropout</text>
      <text x="407" y="130" text-anchor="middle" class="mono" font-size="11" fill="var(--orange)">P=0.25</text>

      <!-- Range -->
      <rect x="260" y="42" width="130" height="26" rx="7" fill="var(--surface)" stroke="var(--purple)" stroke-width="1.2"/>
      <text x="325" y="60" text-anchor="middle" class="mono" font-size="11" font-weight="600" fill="var(--purple)">rango: [-1, +1]</text>

      <!-- Output arrow -->
      <line x1="462" y1="112" x2="500" y2="112" stroke="var(--purple)" stroke-width="2" stroke-dasharray="6,4"/>
      <text x="510" y="117" font-size="11" fill="var(--purple)">â†’</text>

      <!-- Role label -->
      <text x="25" y="210" font-size="9" font-weight="600" fill="var(--purple)">Branch A â€” "Â¿QuÃ© features son relevantes?" Â· Tanh: importancia con signo</text>
    </svg>
  </div>

  <!-- âŠ— connector -->
  <div style="text-align:center;padding:12px 0;">
    <svg width="120" height="80" viewBox="0 0 120 80">
      <line x1="60" y1="0" x2="60" y2="20" stroke="var(--purple)" stroke-width="1.5"/>
      <circle cx="60" cy="40" r="18" fill="var(--surface)" stroke="var(--rose)" stroke-width="3"/>
      <text x="60" y="46" text-anchor="middle" font-size="18" font-weight="700" fill="var(--rose)">âŠ—</text>
      <line x1="60" y1="60" x2="60" y2="80" stroke="var(--green)" stroke-width="1.5"/>
      <text x="98" y="45" font-size="9" font-weight="600" fill="var(--rose)">a âŠ™ b</text>
    </svg>
  </div>

  <!-- ATTENTION B -->
  <div class="diagram-wrap">
    <svg width="560" height="220" viewBox="0 0 560 220">
      <rect x="5" y="5" width="550" height="210" rx="14" fill="rgba(5,150,105,.04)" stroke="var(--green)" stroke-width="1.8"/>
      <text x="25" y="32" font-size="14" font-weight="700" fill="var(--green)">Attention B</text>
      <text x="145" y="32" class="mono" font-size="11" fill="var(--dim)">b(K, 256)</text>

      <!-- Input neurons -->
      <text x="35" y="60" font-size="10" font-weight="600" fill="var(--dim)">512-dim</text>
      <circle cx="50" cy="80" r="7" fill="var(--green)" fill-opacity=".25" stroke="var(--green)" stroke-width="1"/>
      <circle cx="50" cy="100" r="7" fill="var(--green)" fill-opacity=".25" stroke="var(--green)" stroke-width="1"/>
      <circle cx="50" cy="120" r="7" fill="var(--green)" fill-opacity=".25" stroke="var(--green)" stroke-width="1"/>
      <text x="50" y="145" text-anchor="middle" font-size="14" fill="var(--dimmer)">â‹®</text>
      <circle cx="50" cy="160" r="7" fill="var(--green)" fill-opacity=".25" stroke="var(--green)" stroke-width="1"/>

      <!-- Output neurons -->
      <text x="125" y="60" font-size="10" font-weight="600" fill="var(--dim)">256-dim</text>
      <circle cx="140" cy="86" r="7" fill="var(--green)" fill-opacity=".5" stroke="var(--green)" stroke-width="1.2"/>
      <circle cx="140" cy="112" r="7" fill="var(--green)" fill-opacity=".5" stroke="var(--green)" stroke-width="1.2"/>
      <circle cx="140" cy="138" r="7" fill="var(--green)" fill-opacity=".5" stroke="var(--green)" stroke-width="1.2"/>
      <text x="140" y="163" text-anchor="middle" font-size="14" fill="var(--dimmer)">â‹®</text>

      <!-- Connections -->
      <line x1="59" y1="80" x2="131" y2="86" stroke="var(--green)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="59" y1="80" x2="131" y2="112" stroke="var(--green)" stroke-width=".5" stroke-opacity=".1"/>
      <line x1="59" y1="100" x2="131" y2="86" stroke="var(--green)" stroke-width=".5" stroke-opacity=".1"/>
      <line x1="59" y1="100" x2="131" y2="138" stroke="var(--green)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="59" y1="120" x2="131" y2="112" stroke="var(--green)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="59" y1="160" x2="131" y2="138" stroke="var(--green)" stroke-width=".5" stroke-opacity=".2"/>

      <text x="95" y="192" text-anchor="middle" font-size="9" fill="var(--green)">U_a Â· Linear</text>

      <!-- Arrow to Sigmoid -->
      <line x1="168" y1="112" x2="202" y2="112" stroke="var(--slate)" stroke-width="1.5" marker-end="url(#arr)"/>

      <!-- Sigmoid -->
      <rect x="210" y="82" width="100" height="60" rx="10" fill="var(--green-bg)" stroke="var(--green)" stroke-width="2.5"/>
      <text x="260" y="108" text-anchor="middle" font-size="14" font-weight="700" fill="var(--green)">Sigmoid()</text>
      <text x="260" y="132" text-anchor="middle" font-size="9" fill="var(--dim)">Activation</text>

      <!-- Arrow to Dropout -->
      <line x1="315" y1="112" x2="349" y2="112" stroke="var(--slate)" stroke-width="1.5" marker-end="url(#arr)"/>

      <!-- Dropout -->
      <rect x="357" y="82" width="100" height="60" rx="10" fill="var(--orange-bg)" stroke="var(--orange)" stroke-width="2"/>
      <text x="407" y="108" text-anchor="middle" font-size="13" font-weight="700" fill="var(--orange)">Dropout</text>
      <text x="407" y="130" text-anchor="middle" class="mono" font-size="11" fill="var(--orange)">P=0.25</text>

      <!-- Range -->
      <rect x="260" y="42" width="120" height="26" rx="7" fill="var(--surface)" stroke="var(--green)" stroke-width="1.2"/>
      <text x="320" y="60" text-anchor="middle" class="mono" font-size="11" font-weight="600" fill="var(--green)">rango: [0, 1]</text>

      <!-- Output arrow -->
      <line x1="462" y1="112" x2="500" y2="112" stroke="var(--green)" stroke-width="2" stroke-dasharray="6,4"/>
      <text x="510" y="117" font-size="11" fill="var(--green)">â†’</text>

      <!-- Role label -->
      <text x="25" y="210" font-size="9" font-weight="600" fill="var(--green)">Branch B â€” "Â¿CuÃ¡nto dejar pasar?" Â· Sigmoid: gate [0,1]</text>
    </svg>
  </div>

  <!-- Arrow down to Attention C -->
  <div style="text-align:center;padding:8px 0;">
    <svg width="60" height="30" viewBox="0 0 60 30">
      <text x="30" y="20" text-anchor="middle" font-size="12" fill="var(--rose)">â–¼</text>
    </svg>
    <span style="font-family:'IBM Plex Mono',monospace;font-size:.8rem;color:var(--rose);font-weight:600;">A(K, 256) resultado del gating</span>
  </div>

  <!-- ATTENTION C -->
  <div class="diagram-wrap">
    <svg width="800" height="200" viewBox="0 0 800 200">
      <rect x="5" y="5" width="790" height="190" rx="14" fill="rgba(220,38,38,.04)" stroke="var(--red)" stroke-width="1.8"/>
      <text x="25" y="32" font-size="14" font-weight="700" fill="var(--red)">Attention C</text>
      <text x="155" y="32" class="mono" font-size="11" fill="var(--dim)">A(K, 4)</text>

      <!-- Input neurons 256 -->
      <text x="35" y="60" font-size="10" font-weight="600" fill="var(--dim)">256-dim</text>
      <circle cx="50" cy="82" r="6" fill="var(--rose)" fill-opacity=".35" stroke="var(--rose)" stroke-width=".8"/>
      <circle cx="50" cy="102" r="6" fill="var(--rose)" fill-opacity=".35" stroke="var(--rose)" stroke-width=".8"/>
      <circle cx="50" cy="122" r="6" fill="var(--rose)" fill-opacity=".35" stroke="var(--rose)" stroke-width=".8"/>
      <text x="50" y="146" text-anchor="middle" font-size="12" fill="var(--dimmer)">â‹®</text>
      <circle cx="50" cy="160" r="6" fill="var(--rose)" fill-opacity=".35" stroke="var(--rose)" stroke-width=".8"/>

      <!-- Output neurons n_classes -->
      <text x="140" y="60" font-size="10" font-weight="600" fill="var(--dim)">n_classes</text>
      <circle cx="155" cy="88" r="8" fill="var(--red)" fill-opacity=".6" stroke="var(--red)" stroke-width="1.5"/>
      <circle cx="155" cy="114" r="8" fill="var(--red)" fill-opacity=".6" stroke="var(--red)" stroke-width="1.5"/>
      <circle cx="155" cy="140" r="8" fill="var(--red)" fill-opacity=".6" stroke="var(--red)" stroke-width="1.5"/>
      <circle cx="155" cy="166" r="8" fill="var(--red)" fill-opacity=".6" stroke="var(--red)" stroke-width="1.5"/>

      <!-- Connections -->
      <line x1="58" y1="82" x2="145" y2="88" stroke="var(--red)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="58" y1="82" x2="145" y2="114" stroke="var(--red)" stroke-width=".5" stroke-opacity=".1"/>
      <line x1="58" y1="102" x2="145" y2="114" stroke="var(--red)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="58" y1="102" x2="145" y2="140" stroke="var(--red)" stroke-width=".5" stroke-opacity=".1"/>
      <line x1="58" y1="122" x2="145" y2="140" stroke="var(--red)" stroke-width=".5" stroke-opacity=".2"/>
      <line x1="58" y1="160" x2="145" y2="166" stroke="var(--red)" stroke-width=".5" stroke-opacity=".2"/>

      <text x="102" y="188" text-anchor="middle" font-size="9" fill="var(--red)">W_a Â· Linear</text>

      <!-- Arrow to output -->
      <line x1="175" y1="126" x2="220" y2="126" stroke="var(--red)" stroke-width="2" marker-end="url(#arr-red)"/>

      <!-- Output box -->
      <rect x="230" y="30" width="250" height="160" rx="10" fill="var(--surface2)" stroke="var(--border)" stroke-width="1.2"/>
      <text x="355" y="56" text-anchor="middle" font-size="11" font-weight="700" fill="var(--red)">Attention Scores (raw)</text>

      <rect x="244" y="68" width="222" height="18" rx="3" fill="rgba(220,38,38,.05)"/>
      <text x="254" y="82" class="mono" font-size="9" fill="var(--dim)">[ 0.12,  0.75, -0.33,  0.35]</text>

      <rect x="244" y="92" width="222" height="18" rx="3" fill="rgba(220,38,38,.05)"/>
      <text x="254" y="106" class="mono" font-size="9" fill="var(--dim)">[ 0.85,  0.21,  0.88,  0.23]</text>

      <rect x="244" y="116" width="222" height="18" rx="3" fill="rgba(220,38,38,.05)"/>
      <text x="254" y="130" class="mono" font-size="9" fill="var(--dim)">[-0.05,  0.68,  0.50,  0.12]</text>

      <text x="355" y="155" text-anchor="middle" font-size="14" fill="var(--dimmer)">â‹®</text>

      <rect x="244" y="162" width="222" height="18" rx="3" fill="rgba(220,38,38,.05)"/>
      <text x="254" y="176" class="mono" font-size="9" fill="var(--dim)">[ 0.12,  0.75, -0.33,  0.65]</text>

      <!-- Labels -->
      <text x="540" y="80" font-size="10" fill="var(--dim)">Para cada patch hay un</text>
      <text x="540" y="98" font-size="10" fill="var(--dim)">score asociado a cada clase.</text>

      <text x="540" y="140" class="mono" font-size="11" font-weight="600" fill="var(--blue)">â†’ Attention Pooling</text>
      <text x="540" y="160" font-size="10" fill="var(--dim)">(Aggregator Ã— N patches)</text>
      <text x="540" y="180" font-size="10" fill="var(--dim)">Ver HTML 2</text>
    </svg>
  </div>

  <div style="margin-top:8px;font-size:.78rem;color:var(--dimmer);">*Dim. reduction puede ser 256 Ã³ 384 (configurable)</div>

  <div class="insight insight-rose">
    <span class="icon">ğŸ”‘</span>
    <span><b>Â¿Por quÃ© gated?</b> Tanh sola da relevancia en [-1,+1]. Pero sigmoid âˆˆ [0,1] actÃºa como <em>gate</em>: decide cuÃ¡nto dejar pasar. Si bâ‰ˆ0 para una dimensiÃ³n, esa seÃ±al se apaga. El producto aâŠ—b produce scores mÃ¡s discriminativos que usar solo tanh.</span>
  </div>
</div></div>

<!-- ======== SECTION 3: Numerical Example ======== -->
<div class="section-label">
  <div class="num" style="background:var(--orange);">3</div>
  <h2>Ejemplo NumÃ©rico â€” Un patch a travÃ©s del gated attention</h2>
</div>
<div class="card"><div class="card-body">

  <!-- Input -->
  <div class="diagram-wrap">
    <svg width="200" height="80" viewBox="0 0 200 80">
      <rect x="5" y="5" width="190" height="70" rx="10" fill="var(--teal-bg)" stroke="var(--teal)" stroke-width="2"/>
      <text x="100" y="30" text-anchor="middle" font-size="12" font-weight="700" fill="var(--teal)">h_k (patch 3)</text>
      <text x="100" y="50" text-anchor="middle" class="mono" font-size="10" fill="var(--dim)">â„âµÂ¹Â² (after FC)</text>
      <text x="100" y="68" text-anchor="middle" class="mono" font-size="9" fill="var(--teal)">[0.8, -0.3, 1.5, -0.7, ...]</text>
    </svg>
  </div>

  <div style="text-align:center;padding:4px 0;font-size:12px;color:var(--dim);">â–¼ entra a ambas ramas en paralelo</div>

  <!-- Branch A result -->
  <div class="diagram-wrap">
    <svg width="620" height="100" viewBox="0 0 620 100">
      <rect x="5" y="5" width="610" height="90" rx="12" fill="rgba(124,58,237,.04)" stroke="var(--purple)" stroke-width="1.5"/>
      <text x="25" y="30" font-size="12" font-weight="700" fill="var(--purple)">A: V_a Â· h_k â†’ tanh</text>
      <text x="25" y="52" class="mono" font-size="10" fill="var(--dim)">V_a Â· h_k = [2.1, -0.5, 0.3, -1.8]</text>
      <text x="25" y="76" class="mono" font-size="11" fill="var(--purple)">a_k = tanh(Â·Â·Â·) = </text>
      <text x="210" y="76" class="mono" font-size="11" font-weight="700" fill="var(--purple)">[0.97, -0.46, 0.29, -0.95]</text>
      <text x="470" y="76" font-size="9" fill="var(--dim)">fuerte dim1, negativa dim4</text>
    </svg>
  </div>

  <!-- Branch B result -->
  <div class="diagram-wrap" style="margin-top:8px;">
    <svg width="620" height="100" viewBox="0 0 620 100">
      <rect x="5" y="5" width="610" height="90" rx="12" fill="rgba(5,150,105,.04)" stroke="var(--green)" stroke-width="1.5"/>
      <text x="25" y="30" font-size="12" font-weight="700" fill="var(--green)">B: U_a Â· h_k â†’ Ïƒ</text>
      <text x="25" y="52" class="mono" font-size="10" fill="var(--dim)">U_a Â· h_k = [1.5, -2.0, 0.1, 3.0]</text>
      <text x="25" y="76" class="mono" font-size="11" fill="var(--green)">b_k = Ïƒ(Â·Â·Â·) = </text>
      <text x="185" y="76" class="mono" font-size="11" font-weight="700" fill="var(--green)">[0.82, 0.12, 0.52, 0.95]</text>
      <text x="435" y="76" font-size="9" fill="var(--dim)">gate abierto dim1+4, cerrado dim2</text>
    </svg>
  </div>

  <div style="text-align:center;padding:8px 0;font-size:12px;color:var(--rose);font-weight:600;">â–¼ element-wise multiply (âŠ—)</div>

  <!-- Gating result -->
  <div class="diagram-wrap">
    <svg width="700" height="170" viewBox="0 0 700 170">
      <rect x="5" y="5" width="690" height="160" rx="14" fill="rgba(225,29,72,.04)" stroke="var(--rose)" stroke-width="2"/>
      <text x="350" y="30" text-anchor="middle" font-size="13" font-weight="700" fill="var(--rose)">âŠ— Element-Wise Multiply</text>

      <text x="30" y="60" class="mono" font-size="11" fill="var(--purple)">a = [ 0.97, -0.46,  0.29, -0.95]</text>
      <text x="30" y="82" class="mono" font-size="11" fill="var(--green)">b = [ 0.82,  0.12,  0.52,  0.95]</text>
      <line x1="30" y1="92" x2="370" y2="92" stroke="var(--rose)" stroke-width="1.2"/>
      <text x="30" y="112" class="mono" font-size="12" font-weight="700" fill="var(--rose)">g = [ 0.80, -0.06,  0.15, -0.90]</text>

      <!-- Annotations on the right -->
      <rect x="410" y="44" width="270" height="34" rx="6" fill="rgba(220,38,38,.05)"/>
      <text x="425" y="66" font-size="10" fill="var(--dim)">dim 2: a=-0.46 pero gate=<tspan font-weight="700" fill="var(--red)">0.12 â†’ bloqueada</tspan></text>

      <rect x="410" y="86" width="270" height="34" rx="6" fill="rgba(5,150,105,.05)"/>
      <text x="425" y="108" font-size="10" fill="var(--dim)">dim 4: a=-0.95 y gate=<tspan font-weight="700" fill="var(--green)">0.95 â†’ pasa fuerte</tspan></text>

      <text x="425" y="148" font-size="10" font-weight="600" fill="var(--rose)">El gate decide quÃ© informaciÃ³n fluye al score final</text>
    </svg>
  </div>

  <div style="text-align:center;padding:8px 0;font-size:12px;color:var(--red);font-weight:600;">â–¼ W_a Â· g_k (Attention C: 256â†’4)</div>

  <!-- Attention C result -->
  <div class="diagram-wrap">
    <svg width="620" height="60" viewBox="0 0 620 60">
      <rect x="5" y="5" width="610" height="50" rx="10" fill="rgba(220,38,38,.04)" stroke="var(--red)" stroke-width="1.8"/>
      <text x="25" y="36" font-size="12" font-weight="700" fill="var(--red)">Attention C â†’ raw scores patch 3:</text>
      <text x="345" y="36" class="mono" font-size="12" font-weight="700" fill="var(--red)">[2.31, -0.85, 0.42, -1.10]</text>
      <text x="580" y="36" font-size="9" fill="var(--dim)">4 clases</text>
    </svg>
  </div>

  <div style="text-align:center;padding:8px 0;font-size:12px;color:var(--dim);">â–¼ repitiendo para todos los K patches...</div>

  <!-- Full matrix -->
  <div class="diagram-wrap">
    <svg width="620" height="120" viewBox="0 0 620 120">
      <rect x="5" y="5" width="610" height="110" rx="12" fill="var(--surface2)" stroke="var(--border)" stroke-width="1.2"/>
      <text x="25" y="30" font-size="11" font-weight="700" fill="var(--text)">A_raw âˆˆ â„âµË£â´ (K=5 patches)</text>

      <text x="240" y="30" class="mono" font-size="9" fill="var(--dim)">cls_0    cls_1    cls_2    cls_3</text>

      <text x="25" y="52" class="mono" font-size="10" fill="var(--dim)">patch 1:  [ 1.50,   0.20,  -0.30,   0.80]</text>
      <text x="25" y="70" class="mono" font-size="10" fill="var(--dim)">patch 2:  [-0.40,   1.80,   0.60,  -0.20]</text>
      <text x="25" y="88" class="mono" font-size="10" font-weight="700" fill="var(--red)">patch 3:  [ 2.31,  -0.85,   0.42,  -1.10]  â† nuestro ejemplo</text>
      <text x="25" y="106" class="mono" font-size="10" fill="var(--dim)">patch 4:  [ 0.10,   0.50,   2.10,   0.30]</text>

      <text x="470" y="52" class="mono" font-size="10" fill="var(--dim)">Cada columna irÃ¡ a</text>
      <text x="470" y="70" class="mono" font-size="10" font-weight="600" fill="var(--blue)">softmax â†’ HTML 2</text>
    </svg>
  </div>

  <div class="insight insight-orange">
    <span class="icon">ğŸ“Š</span>
    <span><b>Lectura:</b> Patch 3 tiene score alto (2.31) para cls_0 â€” evidencia fuerte para esa clase. Son scores <em>crudos</em> (pre-softmax). La normalizaciÃ³n ocurre en Attention Pooling (HTML 2).</span>
  </div>
</div></div>

<!-- ======== SECTION 4: Parameters ======== -->
<div class="section-label">
  <div class="num" style="background:var(--slate);">4</div>
  <h2>ParÃ¡metros</h2>
</div>
<div class="card"><div class="card-body">
  <div class="stats">
    <div class="stat"><div class="k">Wâ‚ (FC)</div><div class="v" style="color:var(--teal)">525,312</div></div>
    <div class="stat"><div class="k">V_a (tanh)</div><div class="v" style="color:var(--purple)">131,328</div></div>
    <div class="stat"><div class="k">U_a (sigmoid)</div><div class="v" style="color:var(--green)">131,328</div></div>
    <div class="stat"><div class="k">W_a (cls)</div><div class="v" style="color:var(--red)">1,028</div></div>
    <div class="stat"><div class="k">TOTAL</div><div class="v" style="color:var(--text)">788,996</div></div>
  </div>
  <div class="insight insight-blue">
    <span class="icon">ğŸ“Œ</span>
    <span><b>CÃ³digo:</b> <code style="font-size:.78rem;">self.attention_net = nn.Sequential(Linear(1024,512), ReLU(), Dropout(.25), Attn_Net_Gated(L=512, D=256, n_classes=4))</code></span>
  </div>
</div></div>

</div>
</body>
</html>
